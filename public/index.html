<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>EmarkNews - AI ê¸°ë°˜ ê¸€ë¡œë²Œ ë‰´ìŠ¤ í¬í„¸ (Premium v3.0.1)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af',
                        secondary: '#7c3aed',
                    }
                }
            }
        }
    </script>
    <style>
        .news-card {
            transition: all 0.3s ease;
        }
        .news-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .loading {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <!-- í—¤ë” -->
    <header class="bg-white dark:bg-gray-800 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold text-primary dark:text-blue-400">
                        ğŸ“° EmarkNews
                    </h1>
                    <span class="text-sm text-gray-500 dark:text-gray-400">
                        AI ê¸°ë°˜ ê¸€ë¡œë²Œ ë‰´ìŠ¤ í¬í„¸
                    </span>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="refreshBtn" class="btn btn-primary btn-sm">
                        ğŸ”„ ì—…ë°ì´íŠ¸
                    </button>
                    <button id="themeToggle" class="btn btn-ghost btn-sm">
                        ğŸŒ™
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="container mx-auto px-4 py-8">
        <!-- ë¡œë”© ìƒíƒœ -->
        <div id="loadingState" class="text-center py-12">
            <div class="loading">
                <div class="text-4xl mb-4">ğŸ“¡</div>
                <p class="text-lg text-gray-600 dark:text-gray-400">ë‰´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
        </div>

        <!-- íŠ¸ë Œë”© í‚¤ì›Œë“œ -->
        <section id="trendingSection" class="mb-8 hidden">
            <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-200">
                ğŸ”¥ íŠ¸ë Œë”© í‚¤ì›Œë“œ
            </h2>
            <div id="trendingKeywords" class="flex flex-wrap gap-2">
                <!-- íŠ¸ë Œë”© í‚¤ì›Œë“œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </section>

        <!-- ë‰´ìŠ¤ ì„¹ì…˜ë“¤ -->
        <div id="newsContainer" class="space-y-12 hidden">
            <!-- ì„¸ê³„ë‰´ìŠ¤ -->
            <section id="worldNews" class="news-section">
                <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-200 border-b-2 border-primary pb-2">
                    ğŸŒ ì„¸ê³„ë‰´ìŠ¤
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="worldNewsGrid">
                    <!-- ë‰´ìŠ¤ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </section>

            <!-- í•œêµ­ë‰´ìŠ¤ -->
            <section id="koreaNews" class="news-section">
                <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-200 border-b-2 border-secondary pb-2">
                    ğŸ‡°ğŸ‡· í•œêµ­ë‰´ìŠ¤
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="koreaNewsGrid">
                    <!-- ë‰´ìŠ¤ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </section>

            <!-- ì¼ë³¸ë‰´ìŠ¤ -->
            <section id="japanNews" class="news-section">
                <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-200 border-b-2 border-green-500 pb-2">
                    ğŸ‡¯ğŸ‡µ ì¼ë³¸ë‰´ìŠ¤
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="japanNewsGrid">
                    <!-- ë‰´ìŠ¤ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </section>
        </div>

        <!-- ì—ëŸ¬ ìƒíƒœ -->
        <div id="errorState" class="text-center py-12 hidden">
            <div class="text-4xl mb-4">âŒ</div>
            <p class="text-lg text-red-600 dark:text-red-400 mb-4">ë‰´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
            <button onclick="loadNews()" class="btn btn-primary">ë‹¤ì‹œ ì‹œë„</button>
        </div>
    </main>

    <!-- ë‰´ìŠ¤ ëª¨ë‹¬ -->
    <div id="newsModal" class="modal">
        <div class="modal-box max-w-4xl">
            <h3 id="modalTitle" class="font-bold text-lg mb-4"></h3>
            <div id="modalContent" class="py-4">
                <img id="modalImage" class="w-full h-64 object-cover rounded-lg mb-4" style="display: none;">
                <p id="modalDescription" class="text-gray-700 dark:text-gray-300 mb-4"></p>
                <div id="modalMeta" class="text-sm text-gray-500 dark:text-gray-400 mb-4"></div>
                <div id="modalKeywords" class="flex flex-wrap gap-2 mb-4"></div>
            </div>
            <div class="modal-action">
                <a id="modalLink" href="#" target="_blank" class="btn btn-primary">ì›ë¬¸ ë³´ê¸°</a>
                <button class="btn" onclick="closeModal()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- í‘¸í„° -->
    <footer class="bg-white dark:bg-gray-800 mt-16 py-8">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-600 dark:text-gray-400">
                Â© 2024 EmarkNews. AI ê¸°ë°˜ ê¸€ë¡œë²Œ ë‰´ìŠ¤ í¬í„¸
            </p>
            <p class="text-sm text-gray-500 dark:text-gray-500 mt-2">
                ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="lastUpdate">-</span>
            </p>
        </div>
    </footer>

    <script>
        let newsData = null;
        let isDarkMode = localStorage.getItem('darkMode') === 'true';

        // ë‹¤í¬ëª¨ë“œ ì´ˆê¸°í™”
        if (isDarkMode) {
            document.documentElement.classList.add('dark');
            document.getElementById('themeToggle').textContent = 'â˜€ï¸';
        }

        // ë‹¤í¬ëª¨ë“œ í† ê¸€
        document.getElementById('themeToggle').addEventListener('click', () => {
            isDarkMode = !isDarkMode;
            document.documentElement.classList.toggle('dark');
            document.getElementById('themeToggle').textContent = isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™';
            localStorage.setItem('darkMode', isDarkMode);
        });

        // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼
        document.getElementById('refreshBtn').addEventListener('click', () => {
            loadNews(true);
        });

        // ë‰´ìŠ¤ ë¡œë“œ í•¨ìˆ˜
        async function loadNews(forceRefresh = false) {
            const loadingState = document.getElementById('loadingState');
            const newsContainer = document.getElementById('newsContainer');
            const errorState = document.getElementById('errorState');
            const trendingSection = document.getElementById('trendingSection');

            // ìƒíƒœ ì´ˆê¸°í™”
            loadingState.classList.remove('hidden');
            newsContainer.classList.add('hidden');
            errorState.classList.add('hidden');
            trendingSection.classList.add('hidden');

            try {
                // ìºì‹œ ë¬´ë ¥í™”ë¥¼ ìœ„í•œ íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
                const cacheVersion = Date.now();
                const url = forceRefresh ? 
                    `/api/news?v=${cacheVersion}&_t=${cacheVersion}` : 
                    `/api/news?v=${cacheVersion}&_t=${cacheVersion}`;
                const method = forceRefresh ? 'POST' : 'GET';
                
                // ìºì‹œ ë¬´ë ¥í™” í—¤ë” ì¶”ê°€
                const headers = {
                    'Cache-Control': 'no-cache, no-store, must-revalidate',
                    'Pragma': 'no-cache',
                    'Expires': '0'
                };
                
                const response = await fetch(url, { 
                    method,
                    headers
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                newsData = await response.json();
                
                if (forceRefresh && newsData.data) {
                    newsData = newsData.data;
                }

                displayNews(newsData);
                displayTrending(newsData.trending || []);
                updateLastUpdate(newsData.lastUpdated);

                loadingState.classList.add('hidden');
                newsContainer.classList.remove('hidden');
                trendingSection.classList.remove('hidden');

            } catch (error) {
                console.error('ë‰´ìŠ¤ ë¡œë“œ ì˜¤ë¥˜:', error);
                loadingState.classList.add('hidden');
                errorState.classList.remove('hidden');
            }
        }

        // ë‰´ìŠ¤ í‘œì‹œ í•¨ìˆ˜
        function displayNews(data) {
            if (!data.sections) return;

            displaySection('worldNewsGrid', data.sections.world || []);
            displaySection('koreaNewsGrid', data.sections.korea || []);
            displaySection('japanNewsGrid', data.sections.japan || []);
        }

        // ì„¹ì…˜ë³„ ë‰´ìŠ¤ í‘œì‹œ
        function displaySection(gridId, articles) {
            const grid = document.getElementById(gridId);
            grid.innerHTML = '';

            articles.forEach(article => {
                const card = createNewsCard(article);
                grid.appendChild(card);
            });
        }

        // ë‰´ìŠ¤ ì¹´ë“œ ìƒì„±
        function createNewsCard(article) {
            const card = document.createElement('div');
            card.className = 'news-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden cursor-pointer';
            card.onclick = () => openModal(article);

            const imageHtml = article.urlToImage ? 
                `<img src="${article.urlToImage}" alt="${article.title}" class="w-full h-48 object-cover">` : 
                `<div class="w-full h-48 bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                    <span class="text-4xl">ğŸ“°</span>
                </div>`;

            const stars = 'â­'.repeat(article.stars || 3);
            const category = article.category || 'ê¸°íƒ€';
            const source = article.source?.name || 'Unknown';

            card.innerHTML = `
                ${imageHtml}
                <div class="p-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs bg-primary text-white px-2 py-1 rounded">${category}</span>
                        <span class="text-xs text-gray-500">${stars}</span>
                    </div>
                    <h3 class="font-bold text-lg mb-2 text-gray-800 dark:text-gray-200 line-clamp-2">
                        ${article.translatedTitle || article.title}
                    </h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm mb-3 line-clamp-3">
                        ${article.translatedDescription || article.description || ''}
                    </p>
                    <div class="flex justify-between items-center text-xs text-gray-500">
                        <span>${source}</span>
                        <span>${formatDate(article.publishedAt)}</span>
                    </div>
                </div>
            `;

            return card;
        }

        // íŠ¸ë Œë”© í‚¤ì›Œë“œ í‘œì‹œ
        function displayTrending(trending) {
            const container = document.getElementById('trendingKeywords');
            container.innerHTML = '';

            trending.forEach(([keyword, count]) => {
                const badge = document.createElement('span');
                badge.className = 'badge badge-outline badge-lg';
                badge.textContent = `${keyword} (${count})`;
                container.appendChild(badge);
            });
        }

        // ëª¨ë‹¬ ì—´ê¸°
        function openModal(article) {
            document.getElementById('modalTitle').textContent = article.translatedTitle || article.title;
            document.getElementById('modalDescription').textContent = article.translatedDescription || article.description || '';
            document.getElementById('modalLink').href = article.url;

            const modalImage = document.getElementById('modalImage');
            if (article.urlToImage) {
                modalImage.src = article.urlToImage;
                modalImage.style.display = 'block';
            } else {
                modalImage.style.display = 'none';
            }

            const modalMeta = document.getElementById('modalMeta');
            modalMeta.innerHTML = `
                <div>ì†ŒìŠ¤: ${article.source?.name || 'Unknown'}</div>
                <div>ë°œí–‰ì¼: ${formatDate(article.publishedAt)}</div>
                <div>ì¹´í…Œê³ ë¦¬: ${article.category || 'ê¸°íƒ€'}</div>
                <div>í’ˆì§ˆì ìˆ˜: ${article.qualityScore || 0}/20</div>
            `;

            const modalKeywords = document.getElementById('modalKeywords');
            modalKeywords.innerHTML = '';
            if (article.keywords) {
                article.keywords.forEach(keyword => {
                    const badge = document.createElement('span');
                    badge.className = 'badge badge-primary badge-sm';
                    badge.textContent = keyword;
                    modalKeywords.appendChild(badge);
                });
            }

            document.getElementById('newsModal').classList.add('modal-open');
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('newsModal').classList.remove('modal-open');
        }

        // ë‚ ì§œ í¬ë§·íŒ…
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffHours / 24);

            if (diffHours < 1) return 'ë°©ê¸ˆ ì „';
            if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;
            if (diffDays < 7) return `${diffDays}ì¼ ì „`;
            
            return date.toLocaleDateString('ko-KR');
        }

        // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
        function updateLastUpdate(timestamp) {
            if (timestamp) {
                document.getElementById('lastUpdate').textContent = formatDate(timestamp);
            }
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('newsModal').addEventListener('click', (e) => {
            if (e.target.id === 'newsModal') {
                closeModal();
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë‰´ìŠ¤ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', () => {
            loadNews();
        });

        // CSS ìŠ¤íƒ€ì¼ ì¶”ê°€
        const style = document.createElement('style');
        style.textContent = `
            .line-clamp-2 {
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
            .line-clamp-3 {
                display: -webkit-box;
                -webkit-line-clamp: 3;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>

